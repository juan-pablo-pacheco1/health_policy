<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Family Absence Simulator</title>
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:1.25rem;}
    .row{display:flex;gap:1rem;flex-wrap:wrap;}
    .card{border:1px solid #ddd;border-radius:10px;padding:1rem;flex:1;min-width:300px;}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:.5rem 1rem;align-items:center;}
    select,input{padding:.35rem;border:1px solid #ccc;border-radius:6px;}
    button{padding:.5rem 1rem;border:1px solid #ccc;border-radius:8px;background:#fafafa;cursor:pointer;}
    button:hover{background:#f0f0f0;}
  </style>
</head>
<body>
  <h1>üè† Family Absence Simulator</h1>
  <div class="row">
    <div class="card" style="max-width:420px;">
      <h2>Settings</h2>
      <div class="grid">
        <div>Scenario</div>
        <select id="scenario"></select>
        <div>Sample size</div>
        <input id="sample_n" type="number" min="10" step="10">
        <div>Seed</div>
        <input id="seed" type="number" step="1" value="1234">
        <div>Trials</div>
        <input id="trials" type="number" step="10" value="100">
      </div>
      <button id="btn_run" style="margin-top:.75rem;">Run Simulation</button>
    </div>
    <div class="card">
      <h2>Average Absences</h2>
      <div id="avg_chart" style="height:300px;"></div>
      <p id="summary" style="color:#555;font-size:.9rem;"></p>
    </div>
  </div>

<script>
  const FAMILIES  = [{"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 1.0}, {"baseline": 3.0, "loneliness": 2.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 2.0, "loneliness": 5.0, "worry": 3.0, "overwhelm": 2.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 4.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 2.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 2.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 1.0}, {"baseline": 2.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 1.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 1.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 2.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 1.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 3.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 1.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 3.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 3.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 2.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 3.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 3.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 4.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 1.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 2.0}, {"baseline": 2.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 5.0, "worry": 2.0, "overwhelm": 1.0}, {"baseline": 3.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 2.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 2.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 0.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 1.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 1.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 1.0}, {"baseline": 3.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 3.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 2.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 3.0}, {"baseline": 4.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 1.0}, {"baseline": 4.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 2.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 3.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 4.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 1.0}, {"baseline": 3.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 4.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 2.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 2.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 3.0}, {"baseline": 2.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 2.0}, {"baseline": 0.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 3.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 0.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 1.0}, {"baseline": 4.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 3.0}, {"baseline": 3.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 2.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 0.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 3.0, "loneliness": 5.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 3.0}, {"baseline": 4.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 4.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 3.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 3.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 0.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 4.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 5.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 3.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 0.0, "loneliness": 1.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 3.0}];
  const BETAS     = {"overwhelm": 0.0379915, "worry": 0.1098821, "loneliness": 0.453555};
  const SCENARIOS = {"No Intervention": {"loneliness": 0.0, "worry": 0.0, "overwhelm": 0.0}, "Ads Simple": {"loneliness": 0.0, "worry": 0.0, "overwhelm": 0.0}, "Cbt": {"loneliness": 0.27, "worry": 0.0, "overwhelm": 0.0}, "Animal Therapy": {"loneliness": 0.8, "worry": 0.0, "overwhelm": 0.0}};

  function mulberry32(a){return function(){var t=a+=0x6D2B79F5;t=Math.imul(t^(t>>>15),t|1);t^=t+Math.imul(t^(t>>>7),t|61);return((t^(t>>>14))>>>0)/4294967296;}}
  function poisson(lam,rng){ if(lam<=0) return 0; const L=Math.exp(-lam); let k=0,p=1; do{ k++; p*=rng(); }while(p>L); return k-1; }

  function sampleFamilies(N,rng){
    const out=[];for(let i=0;i<N;i++){const idx=Math.floor(rng()*FAMILIES.length);out.push(FAMILIES[idx]);}
    return out;
  }

  function getSettings(){
    return {
      scenName: document.getElementById('scenario').value,
      policy: SCENARIOS[document.getElementById('scenario').value],
      N: Math.max(10, parseInt(document.getElementById('sample_n').value||"10",10)),
      seed: parseInt(document.getElementById('seed').value||"1234",10),
      trials: Math.max(1, parseInt(document.getElementById('trials').value||"100",10))
    };
  }

  function simulateOnce(policy,N,rng){
    const sample=sampleFamilies(N,rng);
    const saved=(BETAS.loneliness||0)*(policy.loneliness||0)+(BETAS.worry||0)*(policy.worry||0)+(BETAS.overwhelm||0)*(policy.overwhelm||0);
    const baseArr=[],afterArr=[];
    for(const f of sample){const base=Number(f.baseline);const lam=Math.max(0,base-saved);baseArr.push(base);afterArr.push(poisson(lam,rng));}
    const mean=a=>a.reduce((x,y)=>x+y,0)/(a.length||1);
    return {base:mean(baseArr), after:mean(afterArr)};
  }

  function run(){
    const s=getSettings();
    const results=[];
    const rng=mulberry32((s.seed>>>0)||1234);
    for(let t=0;t<s.trials;t++){results.push(simulateOnce(s.policy,s.N,rng));}
    const baseVals=results.map(r=>r.base), afterVals=results.map(r=>r.after);
    const mean=a=>a.reduce((x,y)=>x+y,0)/a.length;
    const stderr=a=>{const m=mean(a);return Math.sqrt(a.map(x=>(x-m)**2).reduce((x,y)=>x+y,0)/(a.length-1))/Math.sqrt(a.length);};
    const baseMean=mean(baseVals), afterMean=mean(afterVals);
    const baseErr=stderr(baseVals), afterErr=stderr(afterVals);

    Plotly.react('avg_chart',[{
      x:['Baseline','After ('+s.scenName+')'],
      y:[baseMean,afterMean],
      error_y:{type:'data',array:[baseErr,afterErr],visible:true},
      type:'bar',
      text:[baseMean.toFixed(2),afterMean.toFixed(2)],
      textposition:'auto'
    }],{yaxis:{title:'Absence Days'}},{displayModeBar:false});

    document.getElementById('summary').textContent=`Based on ${s.trials} trials with N=${s.N} families.`;
  }

  function init(){
    const sel=document.getElementById('scenario');
    for(const name of Object.keys(SCENARIOS)){const o=document.createElement('option');o.value=name;o.textContent=name;sel.appendChild(o);}
    document.getElementById('sample_n').value=FAMILIES.length;
    document.getElementById('btn_run').addEventListener('click',run);
    run();
  }
  document.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>
