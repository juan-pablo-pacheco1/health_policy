<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Family Absence: Race Mix + Interventions</title>
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 1.25rem; }
    .row { display:flex; gap:1rem; flex-wrap:wrap; }
    .card { border:1px solid #ddd; border-radius:10px; padding:1rem; flex:1; min-width:300px; }
    .grid { display:grid; grid-template-columns: 1fr 110px; gap:.5rem 1rem; align-items:center; }
    select, input { padding:.3rem; border:1px solid #ccc; border-radius:6px; }
    button { padding:.5rem 1rem; border:1px solid #ccc; border-radius:8px; background:#fafafa; cursor:pointer; }
    button:hover { background:#f0f0f0; }
    h1 { margin:.2rem 0 1rem; }
  </style>
</head>
<body>
  <h1>üè† Family Absence Simulator</h1>

  <div class="row">
    <div class="card" style="max-width:440px;">
      <h2>Settings</h2>
      <div class="grid" style="grid-template-columns: 1fr 1fr;">
        <div>Scenario</div>
        <select id="scenario"></select>

        <div>Sample size</div>
        <input id="sample_n" type="number" min="10" step="10">

        <div>Seed</div>
        <input id="seed" type="number" step="1" value="1234">
      </div>

      <h3 style="margin-top:1rem;">Race/Ethnicity Composition (%)</h3>
      <div class="grid" id="race_inputs"></div>
      <p style="color:#555; font-size:.9rem;">Values auto-normalize to 100%.</p>

      <div style="margin-top:.75rem;">
        <button id="btn_run">Run Simulation</button>
      </div>
    </div>

    <div class="card">
      <h2>Average Absences</h2>
      <div id="avg_chart" style="height:300px;"></div>
    </div>
  </div>

  <div class="row" style="margin-top:1rem;">
    <div class="card">
      <h2>Distribution: Baseline vs After</h2>
      <div id="hist_chart" style="height:320px;"></div>
    </div>
  </div>

<script>
  // ----- Data injected from Python -----
  const FAMILIES = [{"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 3.0, "loneliness": 2.0, "worry": 5.0, "overwhelm": 5.0, "race": "Hispanic/Latino"}, {"baseline": 2.0, "loneliness": 5.0, "worry": 3.0, "overwhelm": 2.0, "race": "White"}, {"baseline": 0.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0, "race": "Black/African American"}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0, "race": "Black/African American"}, {"baseline": 1.0, "loneliness": 1.0, "worry": 3.0, "overwhelm": 3.0, "race": "Prefer not/missing"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "Hispanic/Latino"}, {"baseline": 0.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 1.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 1.0, "race": "Hispanic/Latino"}, {"baseline": 4.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0, "race": "Hispanic/Latino"}, {"baseline": 3.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 2.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 2.0, "race": "White"}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 1.0, "race": "Multiracial"}, {"baseline": 2.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 2.0, "race": "White"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "Multiracial"}, {"baseline": 3.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 1.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 1.0, "race": "Black/African American"}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "Hispanic/Latino"}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0, "race": "Hispanic/Latino"}, {"baseline": 3.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0, "race": "Hispanic/Latino"}, {"baseline": 3.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "Hispanic/Latino"}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "Hispanic/Latino"}, {"baseline": 0.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 4.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 2.0, "race": "Asian"}, {"baseline": 4.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 2.0, "race": "White"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 4.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "Hispanic/Latino"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 2.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 2.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 2.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 3.0, "race": "Hispanic/Latino"}, {"baseline": 2.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 2.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "Black/African American"}, {"baseline": 1.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 3.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 4.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "Multiracial"}, {"baseline": 1.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 2.0, "race": "White"}, {"baseline": 2.0, "loneliness": 2.0, "worry": 5.0, "overwhelm": 4.0, "race": "Multiracial"}, {"baseline": 4.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 3.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 2.0, "race": "Black/African American"}, {"baseline": 1.0, "loneliness": 1.0, "worry": 5.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 2.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "Hispanic/Latino"}, {"baseline": 1.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 2.0, "race": "Black/African American"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 4.0, "race": "Hispanic/Latino"}, {"baseline": 0.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 5.0, "race": "Black/African American"}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 1.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 4.0, "race": "Prefer not/missing"}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 1.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 2.0, "race": "Multiracial"}, {"baseline": 3.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 5.0, "race": "White"}, {"baseline": 0.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 3.0, "race": "Hispanic/Latino"}, {"baseline": 0.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0, "race": "Prefer not/missing"}, {"baseline": 4.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 2.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 2.0, "race": "White"}, {"baseline": 2.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 3.0, "race": "Black/African American"}, {"baseline": 2.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 4.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 1.0, "race": "Hispanic/Latino"}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0, "race": "Black/African American"}, {"baseline": 4.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 1.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0, "race": "Black/African American"}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "Prefer not/missing"}, {"baseline": 1.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0, "race": "Hispanic/Latino"}, {"baseline": 3.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 2.0, "race": "White"}, {"baseline": 2.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 3.0, "race": "Multiracial"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 2.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 4.0, "loneliness": 5.0, "worry": 2.0, "overwhelm": 1.0, "race": "American Indian/Alaska Native"}, {"baseline": 3.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 2.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 4.0, "race": "Hispanic/Latino"}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 1.0, "loneliness": 2.0, "worry": 5.0, "overwhelm": 5.0, "race": "Black/African American"}, {"baseline": 2.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 2.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 1.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 2.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "Some other race"}, {"baseline": 2.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "Prefer not/missing"}, {"baseline": 2.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0, "race": "American Indian/Alaska Native"}, {"baseline": 2.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 2.0, "race": "Black/African American"}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "Prefer not/missing"}, {"baseline": 4.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0, "race": "Prefer not/missing"}, {"baseline": 0.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 4.0, "race": "Black/African American"}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "Hispanic/Latino"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 0.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 2.0, "loneliness": 2.0, "worry": 5.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 3.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "Multiracial"}, {"baseline": 3.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 1.0, "race": "Hispanic/Latino"}, {"baseline": 0.0, "loneliness": 2.0, "worry": 5.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 2.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 1.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 1.0, "race": "Multiracial"}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 2.0, "race": "White"}, {"baseline": 1.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0, "race": "Multiracial"}, {"baseline": 2.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 1.0, "race": "Hispanic/Latino"}, {"baseline": 0.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 1.0, "race": "Hispanic/Latino"}, {"baseline": 3.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 3.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 2.0, "race": "White"}, {"baseline": 2.0, "loneliness": 1.0, "worry": 5.0, "overwhelm": 5.0, "race": "White"}, {"baseline": 4.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 3.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 2.0, "race": "White"}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 4.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 2.0, "race": "White"}, {"baseline": 2.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 4.0, "race": "Multiracial"}, {"baseline": 4.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 2.0, "race": "White"}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 1.0, "race": "Black/African American"}, {"baseline": 4.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 4.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0, "race": "Hispanic/Latino"}, {"baseline": 3.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 2.0, "race": "Black/African American"}, {"baseline": 3.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "Hispanic/Latino"}, {"baseline": 3.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 2.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 4.0, "race": "Black/African American"}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "Black/African American"}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 3.0, "race": "Hispanic/Latino"}, {"baseline": 3.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 5.0, "race": "White"}, {"baseline": 4.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 3.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 3.0, "race": "Black/African American"}, {"baseline": 4.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 4.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 2.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 2.0, "race": "Multiracial"}, {"baseline": 2.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 2.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 2.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "Black/African American"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 4.0, "race": "Hispanic/Latino"}, {"baseline": 3.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 2.0, "race": "Hispanic/Latino"}, {"baseline": 0.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 2.0, "race": "Hispanic/Latino"}, {"baseline": 0.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0, "race": "Hispanic/Latino"}, {"baseline": 4.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 2.0, "race": "Hispanic/Latino"}, {"baseline": 1.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 2.0, "race": "White"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "Prefer not/missing"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 2.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 4.0, "race": "Black/African American"}, {"baseline": 4.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 1.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "Hispanic/Latino"}, {"baseline": 4.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 3.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0, "race": "Hispanic/Latino"}, {"baseline": 0.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 3.0, "race": "Hispanic/Latino"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "Hispanic/Latino"}, {"baseline": 3.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 2.0, "race": "Hispanic/Latino"}, {"baseline": 0.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 1.0, "race": "Multiracial"}, {"baseline": 4.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 3.0, "race": "Hispanic/Latino"}, {"baseline": 3.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0, "race": "Prefer not/missing"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 1.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 4.0, "race": "Hispanic/Latino"}, {"baseline": 1.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 2.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0, "race": "Prefer not/missing"}, {"baseline": 1.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 1.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 0.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 3.0, "race": "Hispanic/Latino"}, {"baseline": 3.0, "loneliness": 5.0, "worry": 2.0, "overwhelm": 4.0, "race": "Prefer not/missing"}, {"baseline": 2.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 2.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 2.0, "race": "Hispanic/Latino"}, {"baseline": 0.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 3.0, "race": "Black/African American"}, {"baseline": 4.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0, "race": "Hispanic/Latino"}, {"baseline": 0.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0, "race": "White"}, {"baseline": 0.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 4.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 4.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 2.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 5.0, "race": "White"}, {"baseline": 3.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "Prefer not/missing"}, {"baseline": 2.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 1.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 1.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 2.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 2.0, "race": "Hispanic/Latino"}, {"baseline": 3.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 0.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 3.0, "race": "Black/African American"}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 1.0, "loneliness": 1.0, "worry": 3.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 2.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 2.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 0.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 4.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 1.0, "race": "Black/African American"}, {"baseline": 3.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 4.0, "race": "Prefer not/missing"}, {"baseline": 2.0, "loneliness": 5.0, "worry": 3.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "Hispanic/Latino"}, {"baseline": 0.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 5.0, "race": "White"}, {"baseline": 4.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "Hispanic/Latino"}, {"baseline": 1.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 3.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 0.0, "loneliness": 1.0, "worry": 3.0, "overwhelm": 3.0, "race": "Prefer not/missing"}, {"baseline": 1.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 3.0, "race": "White"}, {"baseline": 0.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 1.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 3.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 3.0, "race": "Hispanic/Latino"}, {"baseline": 4.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "White"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 4.0, "race": "Hispanic/Latino"}, {"baseline": 1.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 1.0, "race": "White"}, {"baseline": 1.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 3.0, "race": "White"}];      // list of {baseline, loneliness, worry, overwhelm, race}
  const RACES = ["American Indian/Alaska Native", "Asian", "Black/African American", "Hispanic/Latino", "Multiracial", "Prefer not/missing", "Some other race", "White"];            // list of race labels
  const RACE_SHARES_INIT = {"American Indian/Alaska Native": 0.009433962264150943, "Asian": 0.0047169811320754715, "Black/African American": 0.10849056603773585, "Hispanic/Latino": 0.20754716981132076, "Multiracial": 0.05660377358490566, "Prefer not/missing": 0.0660377358490566, "Some other race": 0.0047169811320754715, "White": 0.5424528301886793}; // {race: share}
  const BETAS = {"overwhelm": 0.0379915, "worry": 0.1098821, "loneliness": 0.453555};            // {loneliness, worry, overwhelm}
  const SCENARIOS = {"No Intervention": {"loneliness": 0.0, "worry": 0.0, "overwhelm": 0.0}, "Ads Simple": {"loneliness": 0.0, "worry": 0.0, "overwhelm": 0.0}, "Cbt": {"loneliness": 0.27, "worry": 0.0, "overwhelm": 0.0}, "Animal Therapy": {"loneliness": 0.8, "worry": 0.0, "overwhelm": 0.0}};    // name -> {loneliness, worry, overwhelm}

  // ----- RNG + Poisson -----
  function mulberry32(a){return function(){var t=a+=0x6D2B79F5;t=Math.imul(t^(t>>>15),t|1);t^=t+Math.imul(t^(t>>>7),t|61);return((t^(t>>>14))>>>0)/4294967296;}}
  function poisson(lam,rng){if(lam<=0)return 0;const L=Math.exp(-lam);let k=0,p=1;do{k++;p*=rng();}while(p>L);return k-1;}

  // ----- Resample families by race weights (bootstrap within race) -----
  function resampleFamilies(N,weights,rng){
    const buckets={}; for(const r of RACES) buckets[r]=[];
    for(const f of FAMILIES){ if(!buckets[f.race]) buckets[f.race]=[]; buckets[f.race].push(f); }
    const races=RACES.slice();
    const w=races.map(r=>Math.max(0,weights[r]||0));
    const sumw=w.reduce((a,b)=>a+b,0)||1;
    const cw=[]; let acc=0;
    for(let i=0;i<w.length;i++){ acc+=w[i]/sumw; cw.push(acc); }
    const pickRace=()=>{ const u=Math.random(); for(let i=0;i<cw.length;i++){ if(u<=cw[i]) return races[i]; } return races[races.length-1]; };
    const out=[];
    for(let i=0;i<N;i++){
      const r=pickRace();
      const pool=buckets[r].length?buckets[r]:FAMILIES;
      const idx=Math.floor(Math.random()*pool.length);
      out.push(Object.assign({}, pool[idx]));
    }
    return out;
  }

  // ----- Read UI -----
  function getSettings(){
    const scenName = document.getElementById('scenario').value;
    const policy   = SCENARIOS[scenName]; // {loneliness, worry, overwhelm}

    const raw = {}; let sum = 0;
    for(const r of RACES){
      const v = parseFloat(document.getElementById('rw_'+r).value) || 0;
      raw[r] = Math.max(0, v); sum += raw[r];
    }
    const weights = {};
    if(sum===0){ for(const r of RACES) weights[r]=1/RACES.length; }
    else{ for(const r of RACES) weights[r]=raw[r]/sum; }

    const N    = Math.max(10, parseInt(document.getElementById('sample_n').value || "10", 10));
    const seed = parseInt(document.getElementById('seed').value || "1234", 10);
    return {policy, weights, N, seed, scenName};
  }

  // ----- Core simulation: apply policy via betas -----
  function simulateOnce(policy, weights, N, seed){
    const rng = mulberry32((seed>>>0)||1234);
    const sample = resampleFamilies(N, weights, rng);
    const baseline=[], after=[];
    for(const f of sample){
      const saved =
        BETAS.loneliness * (policy.loneliness||0) +
        BETAS.worry      * (policy.worry||0) +
        BETAS.overwhelm  * (policy.overwhelm||0);
      const lam = Math.max(0, Number(f.baseline) - saved);
      baseline.push(Number(f.baseline));
      after.push(poisson(lam, rng));
    }
    const mean=a=>a.reduce((x,y)=>x+y,0)/(a.length||1);
    return { baselineAvg: mean(baseline), afterAvg: mean(after), baselineArr: baseline, afterArr: after };
  }

  // ----- Charts -----
  function render(r, scenName){
    Plotly.react('avg_chart',[
      {x:['Baseline','After ('+scenName+')'], y:[r.baselineAvg, r.afterAvg], type:'bar',
       text:[r.baselineAvg.toFixed(2), r.afterAvg.toFixed(2)], textposition:'auto'}],
      {yaxis:{title:'Absence Days'}},{displayModeBar:false});

    Plotly.react('hist_chart',[
      {x:r.baselineArr, type:'histogram', opacity:.6, name:'Baseline'},
      {x:r.afterArr,    type:'histogram', opacity:.6, name:'After ('+scenName+')'}],
      {barmode:'overlay', xaxis:{title:'Absence Days'}, yaxis:{title:'Families'}, legend:{orientation:'h'}},
      {displayModeBar:false});
  }

  // ----- Run & Init -----
  function run(){
    const s = getSettings();
    const r = simulateOnce(s.policy, s.weights, s.N, s.seed);
    render(r, s.scenName);
  }

  function init(){
    // Scenario dropdown
    const sel = document.getElementById('scenario');
    for(const name of Object.keys(SCENARIOS)){ const o=document.createElement('option'); o.value=name; o.textContent=name; sel.appendChild(o); }

    // Race inputs
    const c=document.getElementById('race_inputs');
    for(const r of RACES){
      const lab=document.createElement('div'); lab.textContent=r;
      const inp=document.createElement('input'); inp.type='number'; inp.min='0'; inp.step='1';
      inp.id='rw_'+r; inp.value=Math.round((RACE_SHARES_INIT[r]||0)*100);
      c.appendChild(lab); c.appendChild(inp);
    }
    document.getElementById('sample_n').value = FAMILIES.length;
    document.getElementById('btn_run').addEventListener('click', run);
    run();
  }

  document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
