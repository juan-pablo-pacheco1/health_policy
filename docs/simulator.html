<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Race Mix Absence Simulator</title>
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <style>
    body { font-family: sans-serif; margin: 1.5rem; }
    .row { display: flex; gap: 1rem; flex-wrap: wrap; }
    .card { border: 1px solid #ddd; border-radius: 8px; padding: 1rem; flex: 1; min-width: 300px; }
    .grid { display: grid; grid-template-columns: 1fr 100px; gap: .5rem 1rem; align-items: center; }
    button { padding: .5rem 1rem; border: 1px solid #ccc; border-radius: 6px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>üè† Family Absence Simulator</h1>
  <p>Adjust the race/ethnicity mix. Click <b>Run Simulation</b> to update.</p>

  <div class="row">
    <div class="card" style="max-width: 420px;">
      <h2>Race/Ethnicity Composition (%)</h2>
      <div class="grid" id="race_inputs"></div>
      <p style="font-size:0.9rem; color:#555;">Values auto-normalize to 100%.</p>

      <h2>Sampling</h2>
      <div class="grid">
        <div>Sample size</div><input id="sample_n" type="number" min="10" step="10">
        <div>Seed</div><input id="seed" type="number" step="1" value="1234">
      </div>

      <div style="margin-top:1rem;">
        <button id="btn_run">Run Simulation</button>
      </div>
    </div>

    <div class="card">
      <h2>Average Absences</h2>
      <div id="avg_chart" style="height:300px;"></div>
    </div>
  </div>

  <div class="row" style="margin-top:1rem;">
    <div class="card">
      <h2>Distribution</h2>
      <div id="hist_chart" style="height:320px;"></div>
    </div>
  </div>

<script>
  // Data injected from Python
  const FAMILIES = [{"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 3.0, "loneliness": 2.0, "worry": 5.0, "overwhelm": 5.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 2.0, "loneliness": 5.0, "worry": 3.0, "overwhelm": 2.0, "race": "White", "child_age": null}, {"baseline": 0.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0, "race": "Black/African American", "child_age": null}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0, "race": "Black/African American", "child_age": null}, {"baseline": 1.0, "loneliness": 1.0, "worry": 3.0, "overwhelm": 3.0, "race": "Prefer not/missing", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 0.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 1.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 4.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 3.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 2.0, "race": "White", "child_age": null}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 1.0, "race": "Multiracial", "child_age": null}, {"baseline": 2.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 2.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "Multiracial", "child_age": null}, {"baseline": 3.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 1.0, "race": "Black/African American", "child_age": null}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 3.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 3.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 0.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 4.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 2.0, "race": "Asian", "child_age": null}, {"baseline": 4.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 2.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 4.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 3.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 2.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "Black/African American", "child_age": null}, {"baseline": 1.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 3.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 4.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "Multiracial", "child_age": null}, {"baseline": 1.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 2.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 2.0, "worry": 5.0, "overwhelm": 4.0, "race": "Multiracial", "child_age": null}, {"baseline": 4.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 3.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 2.0, "race": "Black/African American", "child_age": null}, {"baseline": 1.0, "loneliness": 1.0, "worry": 5.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 1.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 2.0, "race": "Black/African American", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 4.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 0.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 5.0, "race": "Black/African American", "child_age": null}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 4.0, "race": "Prefer not/missing", "child_age": null}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 2.0, "race": "Multiracial", "child_age": null}, {"baseline": 3.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 5.0, "race": "White", "child_age": null}, {"baseline": 0.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 3.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 0.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0, "race": "Prefer not/missing", "child_age": null}, {"baseline": 4.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 2.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 3.0, "race": "Black/African American", "child_age": null}, {"baseline": 2.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 4.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 1.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0, "race": "Black/African American", "child_age": null}, {"baseline": 4.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0, "race": "Black/African American", "child_age": null}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "Prefer not/missing", "child_age": null}, {"baseline": 1.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 3.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 2.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 3.0, "race": "Multiracial", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 4.0, "loneliness": 5.0, "worry": 2.0, "overwhelm": 1.0, "race": "American Indian/Alaska Native", "child_age": null}, {"baseline": 3.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 4.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 2.0, "worry": 5.0, "overwhelm": 5.0, "race": "Black/African American", "child_age": null}, {"baseline": 2.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "Some other race", "child_age": null}, {"baseline": 2.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "Prefer not/missing", "child_age": null}, {"baseline": 2.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0, "race": "American Indian/Alaska Native", "child_age": null}, {"baseline": 2.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 2.0, "race": "Black/African American", "child_age": null}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "Prefer not/missing", "child_age": null}, {"baseline": 4.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0, "race": "Prefer not/missing", "child_age": null}, {"baseline": 0.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 4.0, "race": "Black/African American", "child_age": null}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 0.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 2.0, "worry": 5.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 3.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "Multiracial", "child_age": null}, {"baseline": 3.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 1.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 0.0, "loneliness": 2.0, "worry": 5.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 1.0, "race": "Multiracial", "child_age": null}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 2.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0, "race": "Multiracial", "child_age": null}, {"baseline": 2.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 1.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 0.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 1.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 3.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 3.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 2.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 1.0, "worry": 5.0, "overwhelm": 5.0, "race": "White", "child_age": null}, {"baseline": 4.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 3.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 2.0, "race": "White", "child_age": null}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 4.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 2.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 4.0, "race": "Multiracial", "child_age": null}, {"baseline": 4.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 2.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 1.0, "race": "Black/African American", "child_age": null}, {"baseline": 4.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 4.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 3.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 2.0, "race": "Black/African American", "child_age": null}, {"baseline": 3.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 3.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 4.0, "race": "Black/African American", "child_age": null}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "Black/African American", "child_age": null}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 3.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 3.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 5.0, "race": "White", "child_age": null}, {"baseline": 4.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 3.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 3.0, "race": "Black/African American", "child_age": null}, {"baseline": 4.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 4.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 2.0, "race": "Multiracial", "child_age": null}, {"baseline": 2.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "Black/African American", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 4.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 3.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 2.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 0.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 2.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 0.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 4.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 2.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 1.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 2.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "Prefer not/missing", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 4.0, "race": "Black/African American", "child_age": null}, {"baseline": 4.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 4.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 3.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 0.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 3.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 3.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 2.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 0.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 1.0, "race": "Multiracial", "child_age": null}, {"baseline": 4.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 3.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 3.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0, "race": "Prefer not/missing", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 4.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 1.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0, "race": "Prefer not/missing", "child_age": null}, {"baseline": 1.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 0.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 3.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 3.0, "loneliness": 5.0, "worry": 2.0, "overwhelm": 4.0, "race": "Prefer not/missing", "child_age": null}, {"baseline": 2.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 2.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 0.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 3.0, "race": "Black/African American", "child_age": null}, {"baseline": 4.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 0.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0, "race": "White", "child_age": null}, {"baseline": 0.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 4.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 4.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 5.0, "race": "White", "child_age": null}, {"baseline": 3.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "Prefer not/missing", "child_age": null}, {"baseline": 2.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 2.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 3.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 0.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 3.0, "race": "Black/African American", "child_age": null}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 1.0, "worry": 3.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 2.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 0.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 4.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 1.0, "race": "Black/African American", "child_age": null}, {"baseline": 3.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 4.0, "race": "Prefer not/missing", "child_age": null}, {"baseline": 2.0, "loneliness": 5.0, "worry": 3.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 0.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 5.0, "race": "White", "child_age": null}, {"baseline": 4.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 1.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 3.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 0.0, "loneliness": 1.0, "worry": 3.0, "overwhelm": 3.0, "race": "Prefer not/missing", "child_age": null}, {"baseline": 1.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 3.0, "race": "White", "child_age": null}, {"baseline": 0.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 3.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 3.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 4.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 4.0, "race": "Hispanic/Latino", "child_age": null}, {"baseline": 1.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 1.0, "race": "White", "child_age": null}, {"baseline": 1.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 3.0, "race": "White", "child_age": null}];
  const RACES = ["American Indian/Alaska Native", "Asian", "Black/African American", "Hispanic/Latino", "Multiracial", "Prefer not/missing", "Some other race", "White"];
  const RACE_SHARES_INIT = {"American Indian/Alaska Native": 0.009433962264150943, "Asian": 0.0047169811320754715, "Black/African American": 0.10849056603773585, "Hispanic/Latino": 0.20754716981132076, "Multiracial": 0.05660377358490566, "Prefer not/missing": 0.0660377358490566, "Some other race": 0.0047169811320754715, "White": 0.5424528301886793};

  function mulberry32(a){return function(){var t=a+=0x6D2B79F5;t=Math.imul(t^(t>>>15),t|1);t^=t+Math.imul(t^(t>>>7),t|61);return((t^(t>>>14))>>>0)/4294967296;}}
  function poisson(lam,rng){if(lam<=0)return 0;const L=Math.exp(-lam);let k=0,p=1;do{k++;p*=rng();}while(p>L);return k-1;}

  function resampleFamilies(N,weights,rng){
    const buckets={};for(const r of RACES)buckets[r]=[];
    for(const f of FAMILIES)buckets[f.race].push(f);
    const races=RACES.slice();
    const w=races.map(r=>Math.max(0,weights[r]||0));
    const sumw=w.reduce((a,b)=>a+b,0)||1;
    const cw=[];let acc=0;for(let i=0;i<w.length;i++){acc+=w[i]/sumw;cw.push(acc);}
    const pickRace=()=>{const u=rng();for(let i=0;i<cw.length;i++){if(u<=cw[i])return races[i];}return races[races.length-1];};
    const out=[];for(let i=0;i<N;i++){const r=pickRace();const pool=buckets[r].length?buckets[r]:FAMILIES;const idx=Math.floor(rng()*pool.length);out.push(Object.assign({},pool[idx]));}
    return out;
  }

  function getSettings(){
    const raw={};let sum=0;
    for(const r of RACES){const v=parseFloat(document.getElementById('rw_'+r).value)||0;raw[r]=Math.max(0,v);sum+=raw[r];}
    const weights={};if(sum===0){for(const r of RACES)weights[r]=1/RACES.length;}else{for(const r of RACES)weights[r]=raw[r]/sum;}
    const N=Math.max(10,parseInt(document.getElementById('sample_n').value||"10",10));
    const seed=parseInt(document.getElementById('seed').value||"1234",10);
    return {weights,N,seed};
  }

  function simulateOnce(weights,N,seed){
    const rng=mulberry32(seed>>>0);
    const sample=resampleFamilies(N,weights,rng);
    const baseline=[],after=[];
    for(const f of sample){const base=Number(f.baseline);const aft=poisson(base,rng);baseline.push(base);after.push(aft);}
    const mean=a=>a.reduce((x,y)=>x+y,0)/(a.length||1);
    return {baselineAvg:mean(baseline),afterAvg:mean(after),baselineArr:baseline,afterArr:after};
  }

  function render(r){
    Plotly.react('avg_chart',[{x:['Baseline','After'],y:[r.baselineAvg,r.afterAvg],type:'bar'}],
      {yaxis:{title:'Absence Days'}},{displayModeBar:false});
    Plotly.react('hist_chart',[
      {x:r.baselineArr,type:'histogram',opacity:0.6,name:'Baseline'},
      {x:r.afterArr,type:'histogram',opacity:0.6,name:'After'}
    ],{barmode:'overlay',xaxis:{title:'Absence Days'},yaxis:{title:'Families'}},{displayModeBar:false});
  }

  function run(){const s=getSettings();const r=simulateOnce(s.weights,s.N,s.seed);render(r);}
  function init(){
    const c=document.getElementById('race_inputs');
    for(const r of RACES){
      const lab=document.createElement('div');lab.textContent=r;
      const inp=document.createElement('input');inp.type='number';inp.min='0';inp.id='rw_'+r;inp.value=Math.round((RACE_SHARES_INIT[r]||0)*100);
      c.appendChild(lab);c.appendChild(inp);
    }
    document.getElementById('sample_n').value=FAMILIES.length;
    document.getElementById('btn_run').addEventListener('click',run);
    run();
  }
  document.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>
