<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>CMC Family Simulator</title>
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:1.5rem;background:#f8f9fa;}
    .container{max-width:1200px;margin:0 auto;}
    h1{color:#2c3e50;margin-bottom:.5rem;}
    .subtitle{color:#7f8c8d;margin-bottom:1.5rem;font-size:1.05rem;}
    .methodology{background:#fff3cd;border-left:4px solid #ffc107;padding:1.25rem;margin-bottom:2rem;border-radius:8px;}
    .methodology h3{margin-top:0;color:#856404;}
    .methodology ul{margin:.5rem 0;padding-left:1.5rem;}
    .methodology li{margin:.25rem 0;color:#856404;}
    .row{display:flex;gap:1.5rem;flex-wrap:wrap;margin-bottom:1.5rem;}
    .card{background:white;border:1px solid #e1e8ed;border-radius:12px;padding:1.5rem;box-shadow:0 2px 4px rgba(0,0,0,0.05);}
    .settings-card{flex:0 0 380px;}
    .chart-card{flex:1;min-width:500px;}
    .grid{display:grid;grid-template-columns:120px 1fr;gap:.75rem 1rem;align-items:center;margin-bottom:1rem;}
    label{font-weight:600;color:#34495e;font-size:.9rem;}
    input,select{padding:.6rem;border:2px solid #e1e8ed;border-radius:8px;font-size:.95rem;transition:border .2s;}
    input:focus,select:focus{outline:none;border-color:#3498db;}
    button{width:100%;padding:.8rem;border:none;border-radius:8px;background:#3498db;color:white;font-weight:600;font-size:1rem;cursor:pointer;transition:background .2s;}
    button:hover{background:#2980b9;}
  </style>
</head>
<body>
  <div class="container">
    <h1>üè† CMC Family Absence Simulator</h1>
    <p class="subtitle">Simulate how caregiver-focused interventions reduce school absences for medically complex children</p>

    <div class="methodology">
      <h3>üìã How This Works:</h3>
      <ul>
        <li><strong>Data Source:</strong> Real survey data from families with medically complex children (CMC) - Family CIRCLE data analysis</li>
        <li><strong>Interventions:</strong> Target <em>caregiver</em> mental health (loneliness, worry, overwhelm)</li>
        <li><strong>Calculation:</strong> Days Saved = (Œ≤ √ó Loneliness Improvement) where Œ≤ = 0.482 (Family CIRCLE data analysis)</li>
        <li><strong>Example:</strong> Multicomponent programs reduce caregiver loneliness by 0.80 points (<a href="https://jamanetwork.com/journals/jamanetworkopen/fullarticle/2797399" target="_blank" style="color:#0066cc;">Hoang et al., JAMA Network Open, 2022</a>) ‚Üí saves 0.39 days per child</li>
        <li><strong>Uncertainty:</strong> Each simulation runs 30 trials with Poisson noise to show realistic variation</li>
      </ul>
    </div>

    <div class="row">
      <div class="card settings-card">
        <h2 style="margin-top:0;color:#2c3e50;">Settings</h2>
        <div class="grid">
          <label>Intervention</label>
          <select id="scenario"></select>
          <label>Sample Size</label>
          <input id="sample_n" type="number" min="10" step="10">
          <label>Trials</label>
          <input id="trials" type="number" min="1" step="1" value="30">
          <label>Seed</label>
          <input id="seed" type="number" step="1" value="1234">
        </div>
        <button id="btn_run">Run Simulation</button>
      </div>

      <div class="card chart-card">
        <h2 style="margin-top:0;color:#2c3e50;">Average Absences (¬± error)</h2>
        <div id="avg_chart" style="height:320px;"></div>
      </div>
    </div>

    <div class="row">
      <div class="card" style="flex:1;">
        <h2 style="margin-top:0;color:#2c3e50;">Distribution: Baseline vs After</h2>
        <div id="hist_chart" style="height:340px;"></div>
      </div>
    </div>
  </div>

<script>
  const FAMILIES  = [{"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 0.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 5.0}, {"baseline": 3.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 2.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 1.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 5.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 2.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 3.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 3.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 3.0, "overwhelm": 2.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 0.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 1.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 2.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 3.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 3.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 5.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 3.0, "loneliness": 5.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 4.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 0.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 2.0}, {"baseline": 3.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 4.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 4.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 0.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 5.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 5.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 4.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 1.0}, {"baseline": 2.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 2.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 4.0, "loneliness": 5.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 2.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 3.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 3.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 3.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 1.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 3.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 0.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 2.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 0.0, "loneliness": 1.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 2.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 4.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 2.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 0.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 1.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 3.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 3.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 3.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 2.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 4.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 5.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 3.0, "loneliness": 1.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 2.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 2.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 4.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 4.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 3.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 4.0, "loneliness": 2.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 2.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 3.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 3.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 5.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 5.0, "overwhelm": 1.0}, {"baseline": 3.0, "loneliness": 5.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 0.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 0.0, "loneliness": 5.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 3.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 4.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 0.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 5.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 0.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 4.0, "loneliness": 5.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 5.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 2.0, "loneliness": 5.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 0.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 5.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 2.0}, {"baseline": 4.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 3.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 5.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 5.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 2.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 3.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 3.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 5.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 3.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 5.0}, {"baseline": 3.0, "loneliness": 2.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 1.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 3.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 4.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 1.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 2.0}, {"baseline": 4.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 0.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 0.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 2.0, "loneliness": 3.0, "worry": 1.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 5.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 3.0, "loneliness": 4.0, "worry": 1.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 1.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 4.0, "loneliness": 5.0, "worry": 1.0, "overwhelm": 3.0}, {"baseline": 0.0, "loneliness": 1.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 2.0, "worry": 3.0, "overwhelm": 3.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 5.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 2.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 1.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 3.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 4.0, "worry": 4.0, "overwhelm": 3.0}, {"baseline": 3.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 4.0, "loneliness": 3.0, "worry": 4.0, "overwhelm": 4.0}, {"baseline": 0.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 3.0}, {"baseline": 0.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 2.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 3.0, "overwhelm": 4.0}, {"baseline": 2.0, "loneliness": 1.0, "worry": 2.0, "overwhelm": 1.0}, {"baseline": 1.0, "loneliness": 5.0, "worry": 4.0, "overwhelm": 5.0}, {"baseline": 1.0, "loneliness": 3.0, "worry": 5.0, "overwhelm": 4.0}];
  const BETAS     = {"overwhelm": 0.1817621, "worry": 0.1026722, "loneliness": 0.4822393};
  const SCENARIOS = {"No Intervention": {"loneliness": 0.0, "worry": 0.0, "overwhelm": 0.0}, "Multicomponent Program": {"loneliness": 0.8, "worry": 0.0, "overwhelm": 0.0}, "Group Counseling": {"loneliness": 0.23, "worry": 0.0, "overwhelm": 0.0}};

  function mulberry32(a){return function(){var t=a+=0x6D2B79F5;t=Math.imul(t^(t>>>15),t|1);t^=t+Math.imul(t^(t>>>7),t|61);return((t^(t>>>14))>>>0)/4294967296;}}
  function poisson(lam,rng){if(lam<=0)return 0;const L=Math.exp(-lam);let k=0,p=1;do{k++;p*=rng();}while(p>L);return k-1;}

  function sampleFamilies(N, rng){
    const out=[]; for(let i=0;i<N;i++){ const idx=Math.floor(rng()*FAMILIES.length); out.push(FAMILIES[idx]); }
    return out;
  }

  function getSettings(){
    const scenName=document.getElementById('scenario').value;
    const N=Math.max(10, parseInt(document.getElementById('sample_n').value||"10",10));
    const seed=parseInt(document.getElementById('seed').value||"1234",10);
    const trials=Math.max(1, parseInt(document.getElementById('trials').value||"30",10));
    return { scenName, policy:SCENARIOS[scenName], N, seed, trials };
  }

  function simulate(policy, N, seed, trials){
    const baselineAvgs=[], afterAvgs=[], baselineAll=[], afterAll=[];
    for(let t=0;t<trials;t++){
      const rng=mulberry32(seed+t);
      const sample=sampleFamilies(N,rng);
      const saved=(BETAS.loneliness||0)*(policy.loneliness||0)+(BETAS.worry||0)*(policy.worry||0)+(BETAS.overwhelm||0)*(policy.overwhelm||0);
      const baseline=[], after=[];
      for(const f of sample){
        const base=Number(f.baseline);
        const lam=Math.max(0,base-saved);
        baseline.push(base); after.push(poisson(lam,rng));
      }
      baselineAvgs.push(baseline.reduce((a,b)=>a+b,0)/baseline.length);
      afterAvgs.push(after.reduce((a,b)=>a+b,0)/after.length);
      baselineAll.push(...baseline); afterAll.push(...after);
    }
    function mean(a){return a.reduce((x,y)=>x+y,0)/a.length;}
    function std(a){const m=mean(a);return Math.sqrt(a.reduce((s,v)=>s+(v-m)**2,0)/a.length);}
    return {
      baselineAvg:mean(baselineAvgs), afterAvg:mean(afterAvgs),
      baselineErr:std(baselineAvgs), afterErr:std(afterAvgs),
      baselineArr:baselineAll, afterArr:afterAll
    };
  }

  function render(r, scenName, trials){
    Plotly.react('avg_chart', [{
      x:['Baseline','After ('+scenName+')'],
      y:[r.baselineAvg, r.afterAvg],
      error_y:{type:'data', array:[r.baselineErr, r.afterErr], visible:true},
      type:'bar',
      marker:{color:['#e74c3c','#27ae60']},
      text:[r.baselineAvg.toFixed(2), r.afterAvg.toFixed(2)],
      textposition:'auto',
      textfont:{color:'white'}
    }], { yaxis:{title:'Absence Days'}, title:'Based on '+trials+' trials', margin:{t:40} }, {displayModeBar:false});

    Plotly.react('hist_chart', [
      { x:r.baselineArr, type:'histogram', opacity:.6, name:'Baseline', marker:{color:'#e74c3c'} },
      { x:r.afterArr, type:'histogram', opacity:.6, name:'After ('+scenName+')', marker:{color:'#27ae60'} }
    ], { barmode:'overlay', xaxis:{title:'Absence Days'}, yaxis:{title:'Families'}, legend:{orientation:'h',y:1.1}, margin:{t:40} }, {displayModeBar:false});
  }

  function run(){ const s=getSettings(); const r=simulate(s.policy,s.N,s.seed,s.trials); render(r,s.scenName,s.trials); }
  function init(){
    const sel=document.getElementById('scenario');
    for(const name of Object.keys(SCENARIOS)){ const o=document.createElement('option'); o.value=name; o.textContent=name; sel.appendChild(o); }
    document.getElementById('sample_n').value=FAMILIES.length;
    document.getElementById('btn_run').addEventListener('click',run);
    run();
  }
  document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
